%%
%% Author: Clay
%% 2020/5/21
%%

\chapter{优化程序性能}
{
    写程序最主要的目标就是使它在所有可能的情况下都正确工作。
    一个运行得很快但是给出错误结果的程序没有任何用处。
    程序员必须写出清晰简洁的代码，不仅是为了自己能看懂代码，也是为了在检查代码和需要修改代码时，其他人能够读懂和理解代码。

    另一方面，在很多情况下，让程序运行的快也是一个重要的考虑因素。

    编写高效程序需要做到：
    必须选择一组适当的算法和数据结构。
    必须编写编译器能够有效优化以转换成高效可执行代码的源代码。
    对于第二点，理解优化编译器的能力和局限性时很重要的。

    在程序开发和优化的过程中，必须考虑代码的使用方式，以及影响它的关键因素。
    通常，必须在实现和维护程序的简单性与它的运行速度之间做出权衡。

    编译器受到\emreg{妨碍优化的因素(optimization blocker)}的阻碍。
    阻碍优化的因素就是程序行为中那些严重依赖于执行环境的方面。

    程序优化的第一步就是消除不必要的工作，让代码尽可能有效地执行所期望的任务。
    这包括消除不必要的函数调用、条件测试和内存引用。
    这些优化不依赖于目标机器的任何具体属性。

    为了使程序性能最大化，程序员和编译器都需要一个目标机器的模型，指明如何处理指令，以及各个操作的时序特性。

    了解了处理器的运作，就可以进行程序优化的第二步，利用处理器提供的\emreg{指令级并行(instruction--level parallelism)}能力，同时执行多条指令。

    \emreg{代码剖析程序(profiler)}是测量程序各个部分性能的工具。

    研究程序的汇编代码表示是理解编译器以及产生的代码会如何运行的最有效手段之一。
    从汇编代码开始，还可以预测什么操作会并行执行，以及它们会如何使用处理器资源。
    常通过\emreg{关键路径(critical path)}来决定执行一个循环所需要的时间。
    所谓关键路径是在循环反复执行过程中形成的数据相关链。

    \input{section01.tex}
}

\cleardoublepage

\endinput
